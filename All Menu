-- TELEPORT V1.0 by Nazam Official - FULLY FIXED
-- Hitam Merah Putih Theme - Fixed Minimize & Initial Load

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local TeleportV1 = {
    positions = {},
    maxPositions = 3,
    currentSelected = 1,
    antiCheatBypass = true,
    deleteMode = false,
    menuVisible = true,  -- Start VISIBLE
    gui = nil,
    mainFrame = nil,
    menuIcon = nil
}

local GUI = {
    mainColor = Color3.fromRGB(20, 20, 20),
    secondaryColor = Color3.fromRGB(255, 255, 255),
    accentColor = Color3.fromRGB(200, 0, 0),
    successColor = Color3.fromRGB(0, 180, 0),
    warningColor = Color3.fromRGB(255, 50, 50)
}

local Sizes = {
    mainFrame = UDim2.new(0, 350, 0, 450),
    titleHeight = 45,
    posFrameHeight = 85,
    buttonHeight = 35,
    spacing = 15,
    menuIconSize = 50
}

-- ANTI-CHEAT BYPASS
local function bypassAntiCheat()
    if not TeleportV1.antiCheatBypass then return end
    
    pcall(function()
        if not getgenv().namecallHooked then
            local oldNamecall
            oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
                local method = getnamecallmethod()
                
                if method and tostring(method):lower():find("teleport") then
                    return true
                end
                
                if method and (tostring(method):lower():find("check") or tostring(method):lower():find("validate")) then
                    return true
                end
                
                if method and (tostring(method):lower():find("kick") or tostring(method):lower():find("report")) then
                    return nil
                end
                
                return oldNamecall(self, ...)
            end)
            getgenv().namecallHooked = true
        end
    end)
end

-- SMOOTH TOGGLE FUNCTION
function TeleportV1:toggleMenu()
    self.menuVisible = not self.menuVisible
    
    if self.menuVisible then
        -- Show main frame with animation
        self.mainFrame.Visible = true
        self.mainFrame.Size = UDim2.new(0, 0, 0, 0)
        
        local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
        local tween = TweenService:Create(self.mainFrame, tweenInfo, {
            Size = Sizes.mainFrame
        })
        tween:Play()
        
        -- Hide menu icon
        self.menuIcon.Visible = false
    else
        -- Hide main frame with animation
        local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In)
        local tween = TweenService:Create(self.mainFrame, tweenInfo, {
            Size = UDim2.new(0, 0, 0, 0)
        })
        tween:Play()
        
        tween.Completed:Connect(function()
            self.mainFrame.Visible = false
            -- Show menu icon
            self.menuIcon.Visible = true
        end)
    end
end

-- CREATE MENU ICON
function TeleportV1:createMenuIcon()
    local menuIcon = Instance.new("TextButton")
    menuIcon.Size = UDim2.new(0, Sizes.menuIconSize, 0, Sizes.menuIconSize)
    menuIcon.Position = UDim2.new(0, 20, 0, 20)
    menuIcon.BackgroundColor3 = GUI.accentColor
    menuIcon.TextColor3 = GUI.secondaryColor
    menuIcon.Text = "☰"
    menuIcon.Font = Enum.Font.GothamBold
    menuIcon.TextSize = 20
    menuIcon.AutoButtonColor = true
    menuIcon.Name = "MenuIcon"
    menuIcon.ZIndex = 10
    menuIcon.Visible = false  -- Hidden saat start
    menuIcon.Parent = self.gui
    
    local iconCorner = Instance.new("UICorner")
    iconCorner.CornerRadius = UDim.new(0, 8)
    iconCorner.Parent = menuIcon
    
    local iconStroke = Instance.new("UIStroke")
    iconStroke.Color = GUI.secondaryColor
    iconStroke.Thickness = 2
    iconStroke.Parent = menuIcon
    
    -- Drag functionality
    local dragging = false
    local dragInput, dragStart, startPos
    
    menuIcon.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = menuIcon.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    menuIcon.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            menuIcon.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X,
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    -- Click to toggle
    menuIcon.MouseButton1Click:Connect(function()
        self:toggleMenu()
    end)
    
    return menuIcon
end

-- CREATE MAIN FRAME
function TeleportV1:createMainFrame()
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = Sizes.mainFrame
    mainFrame.Position = UDim2.new(0.5, -Sizes.mainFrame.X.Offset/2, 0.5, -Sizes.mainFrame.Y.Offset/2)
    mainFrame.BackgroundColor3 = GUI.mainColor
    mainFrame.BackgroundTransparency = 0.05
    mainFrame.BorderSizePixel = 0
    mainFrame.ClipsDescendants = true
    mainFrame.Visible = true  -- VISIBLE AWALNYA
    mainFrame.Name = "MainFrame"
    mainFrame.Parent = self.gui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = mainFrame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = GUI.accentColor
    stroke.Thickness = 2
    stroke.Parent = mainFrame
    
    -- Title bar
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, Sizes.titleHeight)
    titleBar.Position = UDim2.new(0, 0, 0, 0)
    titleBar.BackgroundColor3 = GUI.accentColor
    titleBar.BorderSizePixel = 0
    titleBar.Name = "TitleBar"
    titleBar.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 8)
    titleCorner.Parent = titleBar
    
    -- Fix bottom corners
    local bottomFix = Instance.new("Frame")
    bottomFix.Size = UDim2.new(1, 0, 0, 8)
    bottomFix.Position = UDim2.new(0, 0, 1, -8)
    bottomFix.BackgroundColor3 = GUI.accentColor
    bottomFix.BorderSizePixel = 0
    bottomFix.Parent = titleBar
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(0.7, 0, 1, 0)
    titleLabel.Position = UDim2.new(0.05, 0, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.TextColor3 = GUI.secondaryColor
    titleLabel.Text = "TELEPORT V1.0 - Nazam Official"
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 16
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar
    
    -- Minimize button (was close button)
    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
    minimizeBtn.Position = UDim2.new(1, -40, 0.5, -15)
    minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    minimizeBtn.TextColor3 = GUI.secondaryColor
    minimizeBtn.Text = "−"
    minimizeBtn.Font = Enum.Font.GothamBold
    minimizeBtn.TextSize = 18
    minimizeBtn.AutoButtonColor = false
    minimizeBtn.Name = "MinimizeBtn"
    minimizeBtn.Parent = titleBar
    
    local minimizeCorner = Instance.new("UICorner")
    minimizeCorner.CornerRadius = UDim.new(0, 6)
    minimizeCorner.Parent = minimizeBtn
    
    -- Hover effect
    minimizeBtn.MouseEnter:Connect(function()
        minimizeBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    end)
    
    minimizeBtn.MouseLeave:Connect(function()
        minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    end)
    
    -- Minimize functionality
    minimizeBtn.MouseButton1Click:Connect(function()
        self:toggleMenu()
    end)
    
    -- Drag functionality
    local dragging = false
    local dragInput, dragStart, startPos
    
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    titleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            mainFrame.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X,
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    return mainFrame
end

-- CREATE GUI
function TeleportV1:createGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "TeleportV1_NazamOfficial"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
    
    self.gui = screenGui
    
    -- Create main frame (VISIBLE FIRST)
    self.mainFrame = self:createMainFrame()
    
    -- Create menu icon (HIDDEN FIRST)
    self.menuIcon = self:createMenuIcon()
    
    -- Scroll frame
    local scrollFrame = Instance.new("ScrollingFrame")
    scrollFrame.Size = UDim2.new(1, 0, 1, -Sizes.titleHeight - 100)
    scrollFrame.Position = UDim2.new(0, 0, 0, Sizes.titleHeight)
    scrollFrame.BackgroundTransparency = 1
    scrollFrame.BorderSizePixel = 0
    scrollFrame.ScrollBarThickness = 4
    scrollFrame.ScrollBarImageColor3 = GUI.accentColor
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, Sizes.posFrameHeight * self.maxPositions + Sizes.spacing * (self.maxPositions + 1))
    scrollFrame.Parent = self.mainFrame
    
    -- Position frames
    for i = 1, self.maxPositions do
        local yPosition = Sizes.spacing + (i - 1) * (Sizes.posFrameHeight + Sizes.spacing)
        
        local posFrame = Instance.new("Frame")
        posFrame.Size = UDim2.new(0.9, 0, 0, Sizes.posFrameHeight)
        posFrame.Position = UDim2.new(0.05, 0, 0, yPosition)
        posFrame.BackgroundColor3 = GUI.secondaryColor
        posFrame.BackgroundTransparency = 0.9
        posFrame.BorderSizePixel = 0
        posFrame.Parent = scrollFrame
        
        local posFrameCorner = Instance.new("UICorner")
        posFrameCorner.CornerRadius = UDim.new(0, 6)
        posFrameCorner.Parent = posFrame
        
        local posFrameStroke = Instance.new("UIStroke")
        posFrameStroke.Color = GUI.accentColor
        posFrameStroke.Thickness = 1
        posFrameStroke.Parent = posFrame
        
        local posLabel = Instance.new("TextLabel")
        posLabel.Size = UDim2.new(0.55, 0, 0.4, 0)
        posLabel.Position = UDim2.new(0.05, 0, 0.1, 0)
        posLabel.BackgroundTransparency = 1
        posLabel.TextColor3 = GUI.warningColor
        posLabel.Text = "POSISI "..i.." [BELUM DI SET]"
        posLabel.Font = Enum.Font.GothamSemibold
        posLabel.TextSize = 13
        posLabel.TextXAlignment = Enum.TextXAlignment.Left
        posLabel.Name = "PosLabel"..i
        posLabel.Parent = posFrame
        
        local statusIndicator = Instance.new("Frame")
        statusIndicator.Size = UDim2.new(0.55, 0, 0, 3)
        statusIndicator.Position = UDim2.new(0.05, 0, 0.55, 0)
        statusIndicator.BackgroundColor3 = GUI.warningColor
        statusIndicator.BorderSizePixel = 0
        statusIndicator.Name = "StatusIndicator"..i
        statusIndicator.Parent = posFrame
        
        local buttonContainer = Instance.new("Frame")
        buttonContainer.Size = UDim2.new(0.35, 0, 0.75, 0)
        buttonContainer.Position = UDim2.new(0.6, 0, 0.125, 0)
        buttonContainer.BackgroundTransparency = 1
        buttonContainer.Parent = posFrame
        
        local teleportBtn = Instance.new("TextButton")
        teleportBtn.Size = UDim2.new(1, 0, 0.45, 0)
        teleportBtn.Position = UDim2.new(0, 0, 0, 0)
        teleportBtn.BackgroundColor3 = GUI.accentColor
        teleportBtn.TextColor3 = GUI.secondaryColor
        teleportBtn.Text = "TELEPORT"
        teleportBtn.Font = Enum.Font.GothamBold
        teleportBtn.TextSize = 11
        teleportBtn.AutoButtonColor = false
        teleportBtn.Name = "TeleportBtn"..i
        teleportBtn.Parent = buttonContainer
        
        local teleportCorner = Instance.new("UICorner")
        teleportCorner.CornerRadius = UDim.new(0, 4)
        teleportCorner.Parent = teleportBtn
        
        teleportBtn.MouseEnter:Connect(function()
            teleportBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        end)
        
        teleportBtn.MouseLeave:Connect(function()
            teleportBtn.BackgroundColor3 = GUI.accentColor
        end)
        
        local setBtn = Instance.new("TextButton")
        setBtn.Size = UDim2.new(1, 0, 0.45, 0)
        setBtn.Position = UDim2.new(0, 0, 0.55, 0)
        setBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        setBtn.TextColor3 = GUI.secondaryColor
        setBtn.Text = "SET POSISI"
        setBtn.Font = Enum.Font.GothamBold
        setBtn.TextSize = 10
        setBtn.AutoButtonColor = false
        setBtn.Name = "SetBtn"..i
        setBtn.Parent = buttonContainer
        
        local setCorner = Instance.new("UICorner")
        setCorner.CornerRadius = UDim.new(0, 4)
        setCorner.Parent = setBtn
        
        setBtn.MouseEnter:Connect(function()
            setBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        end)
        
        setBtn.MouseLeave:Connect(function()
            setBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        end)
        
        local deleteBtn = Instance.new("TextButton")
        deleteBtn.Size = UDim2.new(0, 25, 0, 25)
        deleteBtn.Position = UDim2.new(1, -30, 0, 5)
        deleteBtn.BackgroundColor3 = GUI.accentColor
        deleteBtn.TextColor3 = GUI.secondaryColor
        deleteBtn.Text = "✕"
        deleteBtn.Font = Enum.Font.GothamBold
        deleteBtn.TextSize = 14
        deleteBtn.AutoButtonColor = false
        deleteBtn.Name = "DeleteBtn"..i
        deleteBtn.Visible = false
        deleteBtn.ZIndex = 2
        deleteBtn.Parent = posFrame
        
        local deleteCorner = Instance.new("UICorner")
        deleteCorner.CornerRadius = UDim.new(0, 12)
        deleteCorner.Parent = deleteBtn
        
        deleteBtn.MouseEnter:Connect(function()
            deleteBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        end)
        
        deleteBtn.MouseLeave:Connect(function()
            deleteBtn.BackgroundColor3 = GUI.accentColor
        end)
    end
    
    -- Control frame
    local controlFrame = Instance.new("Frame")
    controlFrame.Size = UDim2.new(1, 0, 0, 100)
    controlFrame.Position = UDim2.new(0, 0, 1, -100)
    controlFrame.BackgroundTransparency = 1
    controlFrame.Parent = self.mainFrame
    
    local deleteModeBtn = Instance.new("TextButton")
    deleteModeBtn.Size = UDim2.new(0.9, 0, 0, Sizes.buttonHeight)
    deleteModeBtn.Position = UDim2.new(0.05, 0, 0.3, 0)
    deleteModeBtn.BackgroundColor3 = GUI.accentColor
    deleteModeBtn.TextColor3 = GUI.secondaryColor
    deleteModeBtn.Text = "DELETE POSISI"
    deleteModeBtn.Font = Enum.Font.GothamBold
    deleteModeBtn.TextSize = 14
    deleteModeBtn.AutoButtonColor = false
    deleteModeBtn.Name = "DeleteModeBtn"
    deleteModeBtn.Parent = controlFrame
    
    local deleteModeCorner = Instance.new("UICorner")
    deleteModeCorner.CornerRadius = UDim.new(0, 6)
    deleteModeCorner.Parent = deleteModeBtn
    
    deleteModeBtn.MouseEnter:Connect(function()
        deleteModeBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    end)
    
    deleteModeBtn.MouseLeave:Connect(function()
        deleteModeBtn.BackgroundColor3 = GUI.accentColor
    end)
    
    return screenGui
end

-- TELEPORT FUNCTIONS
function TeleportV1:setPosition(index)
    if index > self.maxPositions then return end
    
    local character = Players.LocalPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        self.positions[index] = character.HumanoidRootPart.CFrame
        self.currentSelected = index
        self:updateGUI()
    end
end

function TeleportV1:teleportToPosition(index)
    if not self.positions[index] then return end
    
    bypassAntiCheat()
    
    local character = Players.LocalPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local rootPart = character.HumanoidRootPart
        
        pcall(function()
            rootPart.CFrame = self.positions[index]
        end)
        
        wait(0.1)
        pcall(function()
            character:SetPrimaryPartCFrame(self.positions[index])
        end)
        
        wait(0.05)
        pcall(function()
            rootPart.Position = self.positions[index].Position
        end)
    end
end

function TeleportV1:deletePosition(index)
    self.positions[index] = nil
    self:updateGUI()
end

function TeleportV1:updateGUI()
    for i = 1, self.maxPositions do
        local posLabel = self.gui:FindFirstChild("PosLabel"..i, true)
        local statusIndicator = self.gui:FindFirstChild("StatusIndicator"..i, true)
        
        if posLabel and statusIndicator then
            if self.positions[i] then
                posLabel.Text = "POSISI "..i.." [ACTIVE]"
                posLabel.TextColor3 = GUI.successColor
                statusIndicator.BackgroundColor3 = GUI.successColor
            else
                posLabel.Text = "POSISI "..i.." [BELUM DI SET]"
                posLabel.TextColor3 = GUI.warningColor
                statusIndicator.BackgroundColor3 = GUI.warningColor
            end
        end
    end
end

function TeleportV1:setupEvents()
    for i = 1, self.maxPositions do
        local setBtn = self.gui:FindFirstChild("SetBtn"..i, true)
        local teleportBtn = self.gui:FindFirstChild("TeleportBtn"..i, true)
        local deleteBtn = self.gui:FindFirstChild("DeleteBtn"..i, true)
        
        if setBtn then
            setBtn.MouseButton1Click:Connect(function()
                self:setPosition(i)
            end)
        end
        
        if teleportBtn then
            teleportBtn.MouseButton1Click:Connect(function()
                self:teleportToPosition(i)
            end)
        end
        
        if deleteBtn then
            deleteBtn.MouseButton1Click:Connect(function()
                self:deletePosition(i)
                deleteBtn.Visible = false
            end)
        end
    end
    
    local deleteModeBtn = self.gui:FindFirstChild("DeleteModeBtn", true)
    if deleteModeBtn then
        deleteModeBtn.MouseButton1Click:Connect(function()
            self.deleteMode = not self.deleteMode
            for i = 1, self.maxPositions do
                local deleteBtn = self.gui:FindFirstChild("DeleteBtn"..i, true)
                if deleteBtn then
                    deleteBtn.Visible = self.deleteMode
                end
            end
            
            if self.deleteMode then
                deleteModeBtn.Text = "CANCEL DELETE"
                deleteModeBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
            else
                deleteModeBtn.Text = "DELETE POSISI"
                deleteModeBtn.BackgroundColor3 = GUI.accentColor
            end
        end)
    end
end

function TeleportV1:init()
    self.gui = self:createGUI()
    self:setupEvents()
    bypassAntiCheat()
    
    print("✅ Teleport V1.0 Loaded - By Nazam Official")
end

-- Initialize
TeleportV1:init()
